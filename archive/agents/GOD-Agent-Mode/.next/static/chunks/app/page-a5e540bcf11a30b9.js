(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3006:function(e,t,n){Promise.resolve().then(n.bind(n,1297))},1297:function(e,t,n){"use strict";n.d(t,{default:function(){return j}});var o=n(7437),a=n(2265),i=n(7082),l=n(4281),d=n(8440),s=n(6554),r=n(19);let c=r.KmV(["string","number","boolean","json","flow"]),u=r.Ryn({id:r.Z_8(),label:r.Z_8().min(1),type:c}),p=r.Ryn({label:r.Z_8(),config:r.IMB(r.Z_8(),r._4T()).optional(),code:r.Z_8().optional()}),g=r.Ryn({id:r.Z_8(),type:r.Z_8(),position:r.Ryn({x:r.Rxh(),y:r.Rxh()}),data:p,inputs:r.IXX(u),outputs:r.IXX(u)}),h=r.Ryn({id:r.Z_8(),nodes:r.IXX(g),edges:r.IXX(r.Ryn({id:r.Z_8(),source:r.Z_8(),sourceHandle:r.Z_8(),target:r.Z_8(),targetHandle:r.Z_8()}))});function v(e){let{value:t,onChange:n}=e,[i,l]=(0,a.useState)(()=>t?JSON.stringify(t,null,2):'{\n  "id": "sub-graph",\n  "nodes": [],\n  "edges": []\n}'),[d,s]=(0,a.useState)(null),r=(0,a.useMemo)(()=>d?"Invalid":"Valid",[d]);return(0,o.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,o.jsx)("div",{className:"text-sm opacity-80",children:"Composite Subgraph Editor"}),(0,o.jsxs)("div",{className:"text-xs opacity-60",children:["Status: ",r]}),d?(0,o.jsx)("div",{className:"text-xs text-red-400",children:d}):null,(0,o.jsx)("textarea",{className:"bg-black/30 border border-white/10 rounded px-2 py-1 w-full h-48 font-mono text-xs",value:i,onChange:e=>l(e.target.value),"aria-label":"Composite Subgraph JSON"}),(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:()=>{try{let e=JSON.parse(i),t=h.parse(e);s(null),n(t)}catch(e){s(e instanceof Error?e.message:String(e))}},"aria-label":"Apply Subgraph",children:"Apply"})]})}function f(e){let t=[],n={};for(let t of e.nodes)n[t.id]=t;for(let o of e.edges){let e=n[o.source],a=n[o.target];e||t.push("Edge ".concat(o.id,": source node '").concat(o.source,"' not found")),a||t.push("Edge ".concat(o.id,": target node '").concat(o.target,"' not found")),e&&!e.outputs.some(e=>e.id===o.sourceHandle)&&t.push("Edge ".concat(o.id,": sourceHandle '").concat(o.sourceHandle,"' not found in node '").concat(e.id,"' outputs")),a&&!a.inputs.some(e=>e.id===o.targetHandle)&&t.push("Edge ".concat(o.id,": targetHandle '").concat(o.targetHandle,"' not found in node '").concat(a.id,"' inputs"))}return t}n(6556);let b={processor:async e=>{let t=e.inputs.input||"";return(e.log("Processing: ".concat(t)),await new Promise(e=>setTimeout(e,100)),"string"==typeof t)?{result:t.toUpperCase()}:{result:t}},input:async e=>({output:e.inputs.value||"Hello Hyperflow"}),output:async e=>(e.log("OUTPUT RECEIVED: ".concat(JSON.stringify(e.inputs))),{})};async function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{id:"temp",nodes:[],edges:[]},a=b[e.type];if(!a)throw Error("No executor found for node type: ".concat(e.type));try{return await a({graph:o,nodeId:e.id,inputs:t,log:n})}catch(t){throw n("ERROR in Node ".concat(e.id,": ").concat(t)),t}}async function m(e){console.log("⚡ Starting Hyperflow Execution...");let t=f(e);t.length&&console.warn("Graph reference validation errors:",t);let n=e.nodes.filter(e=>"input"===e.type),o={};for(let t of n){var a,i;let n="string"==typeof(null===(a=t.data.config)||void 0===a?void 0:a.value)?null===(i=t.data.config)||void 0===i?void 0:i.value:"",l=await y(t,{value:n},console.log,e);for(let n of(o[t.id]=l,console.log("[".concat(t.data.label,"] Emitted:"),l),e.edges.filter(e=>e.source===t.id))){let t=e.nodes.find(e=>e.id===n.target);if(t){let a=n.sourceHandle||Object.keys(l)[0],i=n.targetHandle||"input",d={};d[i]=l[a];let s=await y(t,d,console.log,e);o[t.id]=s,console.log("[".concat(t.data.label,"] Emitted:"),s)}}}return console.log("⚡ Flow Complete."),o}async function x(e){console.log("\uD83D\uDC51 Pantheon: orchestrating agents over Hyperflow...");let t=await m(e);return console.log("\uD83D\uDC51 Pantheon: run complete."),t}function w(e){return{nodes:e.nodes.map(e=>({id:e.id,position:e.position,data:{label:e.data.label,config:e.data.config,hyperType:e.type},type:"default"})),edges:e.edges.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle}))}}function j(e){var t,n,r,c;let{initial:u}=e,{nodes:p,edges:g}=(0,a.useMemo)(()=>w(u),[u]),[f,b,y]=(0,i.Rr)(p),[j,N,S]=(0,i.ll)(g),[C,k]=a.useState(null),[H,O]=a.useState([16,16]),[I,E]=a.useState(null);(0,a.useRef)(null);let R=(0,a.useCallback)(e=>{N(t=>(0,i.Z_)(e,t))},[N]),_=(0,a.useCallback)(e=>{var t;let{nodes:n}=e;k(null!==(t=n[0])&&void 0!==t?t:null)},[]),A=(0,a.useCallback)(async()=>{let e=f.map(e=>{var t,n,o;return{id:e.id,type:(null===(t=u.nodes.find(t=>t.id===e.id))||void 0===t?void 0:t.type)||"processor",position:e.position,data:{label:String((null===(n=e.data)||void 0===n?void 0:n.label)||"Node"),config:null===(o=e.data)||void 0===o?void 0:o.config},inputs:[],outputs:[]}}),t={id:u.id,nodes:e,edges:j.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:String(e.sourceHandle||"output"),targetHandle:String(e.targetHandle||"input")}))};h.parse(t),await m(t)},[f,j,u]);(0,a.useEffect)(()=>{let e=localStorage.getItem("hyperflowGraph");if(e)try{let t=JSON.parse(e),n=h.parse(t),o=w(n);b(o.nodes),N(o.edges)}catch(e){}},[b,N]),(0,a.useEffect)(()=>{let e=f.map(e=>{var t,n,o;return{id:e.id,type:(null===(t=u.nodes.find(t=>t.id===e.id))||void 0===t?void 0:t.type)||"processor",position:e.position,data:{label:String((null===(n=e.data)||void 0===n?void 0:n.label)||"Node"),config:null===(o=e.data)||void 0===o?void 0:o.config},inputs:[],outputs:[]}}),t={id:u.id,nodes:e,edges:j.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:String(e.sourceHandle||"output"),targetHandle:String(e.targetHandle||"input")}))};localStorage.setItem("hyperflowGraph",JSON.stringify(t))},[f,j,u.id,u.nodes]);let Z=(0,a.useCallback)(e=>{let t="node-".concat(Date.now(),"-").concat(Math.floor(1e3*Math.random())),n={x:100+200*Math.random(),y:100+120*Math.random()},o={label:e.charAt(0).toUpperCase()+e.slice(1)};"csvInput"===e&&(o.config={value:"name,age\nAda,36\nTuring,42"}),"map"===e&&(o.config={mode:"uppercase"}),"branch"===e&&(o.config={key:"input"}),"merge"===e&&(o.config={strategy:"last",inputs:["a","b"]}),"condition"===e&&(o.config={predicateKey:"ok",truthyOut:"true",falsyOut:"false"}),"composite"===e&&(o.config={...o.config||{},subgraph:{id:"sub-".concat(t),nodes:[{id:"s1",type:"csvInput",position:{x:0,y:0},data:{label:"CSV",config:{value:"city,pop\nNeo,100\nZion,200"}},inputs:[],outputs:[{id:"so1",label:"Out",type:"json"}]},{id:"s2",type:"map",position:{x:200,y:0},data:{label:"Upper"},inputs:[{id:"si1",label:"In",type:"json"}],outputs:[{id:"so2",label:"Out",type:"json"}]},{id:"s3",type:"sinkConsole",position:{x:400,y:0},data:{label:"Sink"},inputs:[{id:"si2",label:"In",type:"json"}],outputs:[]}],edges:[{id:"se1",source:"s1",sourceHandle:"so1",target:"s2",targetHandle:"si1"},{id:"se2",source:"s2",sourceHandle:"so2",target:"s3",targetHandle:"si2"}]}}),b(e=>e.concat({id:t,position:n,data:o,type:"default"}))},[b]),D=(0,a.useCallback)(()=>{if(!C||!window.confirm("Delete selected node?"))return;let e=C.id;b(t=>t.filter(t=>t.id!==e)),N(t=>t.filter(t=>t.source!==e&&t.target!==e)),k(null)},[C,b,N]);return(0,a.useEffect)(()=>{let e=e=>{"Delete"===e.key&&D(),(e.ctrlKey||e.metaKey)&&"n"===e.key.toLowerCase()&&Z("processor")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[D,Z]),(0,o.jsx)("div",{className:"h-screen w-screen",children:(0,o.jsxs)("div",{className:"flex h-full",children:[(0,o.jsx)("div",{className:"flex-1",children:(0,o.jsxs)(i.x$,{nodes:f,edges:j,onNodesChange:y,onEdgesChange:S,onConnect:R,onSelectionChange:_,snapToGrid:!0,snapGrid:H,fitView:!0,children:[(0,o.jsx)(l.A,{}),(0,o.jsx)(d.a,{pannable:!0,zoomable:!0}),(0,o.jsx)(s.Z,{})]})}),(0,o.jsxs)("div",{className:"w-80 border-l border-white/10 p-4",children:[(0,o.jsx)("div",{className:"text-sm opacity-80",children:"Properties"}),C?(0,o.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,o.jsx)("div",{className:"text-xs",children:"ID"}),(0,o.jsx)("div",{className:"text-sm",children:C.id}),(0,o.jsx)("div",{className:"text-xs mt-3",children:"Label"}),(0,o.jsx)("input",{className:"bg-black/30 border border-white/10 rounded px-2 py-1 w-full",value:String((null===(t=C.data)||void 0===t?void 0:t.label)||""),onChange:e=>{let t=e.target.value;b(e=>e.map(e=>e.id===C.id?{...e,data:{label:t}}:e))},"aria-label":"Node Label"}),"composite"===String((null===(n=C.data)||void 0===n?void 0:n.hyperType)||"")?(0,o.jsx)(v,{value:null===(c=C.data)||void 0===c?void 0:null===(r=c.config)||void 0===r?void 0:r.subgraph,onChange:e=>{b(t=>t.map(t=>{if(t.id!==C.id)return t;let n=t.data,o={...n,config:{...n.config||{},subgraph:e}};return{...t,data:o}}))}}):null,(0,o.jsx)("button",{className:"mt-4 bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:A,"aria-label":"Run Flow",children:"Run Flow"}),(0,o.jsx)("button",{className:"mt-2 bg-purple-500/30 hover:bg-purple-500/40 px-3 py-1 rounded",onClick:async()=>{try{let e=f.map(e=>{var t,n,o;return{id:e.id,type:(null===(t=u.nodes.find(t=>t.id===e.id))||void 0===t?void 0:t.type)||"processor",position:e.position,data:{label:String((null===(n=e.data)||void 0===n?void 0:n.label)||"Node"),config:null===(o=e.data)||void 0===o?void 0:o.config},inputs:[],outputs:[]}}),t={id:u.id,nodes:e,edges:j.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:String(e.sourceHandle||"output"),targetHandle:String(e.targetHandle||"input")}))};h.parse(t),await x(t),E(null)}catch(t){let e=t instanceof Error?t.message:String(t);console.error(e),E(e),alert(e)}},"aria-label":"Run Pantheon",children:"Run with Pantheon"}),I?(0,o.jsx)("div",{className:"text-xs text-red-400",children:I}):null,(0,o.jsx)("button",{className:"mt-2 bg-red-500/20 hover:bg-red-500/30 px-3 py-1 rounded",onClick:D,"aria-label":"Delete Selected",children:"Delete"})]}):(0,o.jsx)("div",{className:"mt-4 text-sm opacity-60",children:"Select a node"}),(0,o.jsxs)("div",{className:"mt-6",children:[(0,o.jsx)("div",{className:"text-sm opacity-80",children:"Grid"}),(0,o.jsxs)("select",{className:"bg-black/30 border border-white/10 rounded px-2 py-1 w-full",value:H[0],onChange:e=>{let t=Number(e.target.value);O([t,t])},"aria-label":"Grid Size",children:[(0,o.jsx)("option",{value:8,children:"8px"}),(0,o.jsx)("option",{value:16,children:"16px"}),(0,o.jsx)("option",{value:32,children:"32px"})]})]}),(0,o.jsxs)("div",{className:"mt-6",children:[(0,o.jsx)("div",{className:"text-sm opacity-80",children:"Palette"}),(0,o.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:()=>Z("csvInput"),"aria-label":"Add CSV Input",children:"CSV Input"}),(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:()=>Z("map"),"aria-label":"Add Map",children:"Map"}),(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:()=>Z("sinkConsole"),"aria-label":"Add Console Sink",children:"Console Sink"}),(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:()=>Z("branch"),"aria-label":"Add Branch",children:"Branch"}),(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:()=>Z("merge"),"aria-label":"Add Merge",children:"Merge"}),(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:()=>Z("condition"),"aria-label":"Add Condition",children:"Condition"}),(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded col-span-2",onClick:()=>Z("composite"),"aria-label":"Add Composite",children:"Composite"})]})]}),(0,o.jsxs)("div",{className:"mt-6",children:[(0,o.jsx)("div",{className:"text-sm opacity-80",children:"Data"}),(0,o.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,o.jsx)("button",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded",onClick:()=>{let e=f.map(e=>{var t,n;return{id:e.id,type:(null===(t=u.nodes.find(t=>t.id===e.id))||void 0===t?void 0:t.type)||"processor",position:e.position,data:{label:String((null===(n=e.data)||void 0===n?void 0:n.label)||"Node")},inputs:[],outputs:[]}}),t=new Blob([JSON.stringify({id:u.id,nodes:e,edges:j.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:String(e.sourceHandle||"output"),targetHandle:String(e.targetHandle||"input")}))},null,2)],{type:"application/json"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download="hypergraph.json",o.click(),URL.revokeObjectURL(n)},"aria-label":"Export JSON",children:"Export"}),(0,o.jsxs)("label",{className:"bg-white/10 hover:bg-white/20 px-3 py-1 rounded cursor-pointer","aria-label":"Import JSON",children:["Import",(0,o.jsx)("input",{type:"file",accept:"application/json",className:"hidden",onChange:async e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;let o=await n.text();try{let e=JSON.parse(o),t=h.parse(e),n=w(t);b(n.nodes),N(n.edges)}catch(e){}}})]})]})]})]})]})})}b.composite=async e=>{var t;let n=e.graph.nodes.find(t=>t.id===e.nodeId),o=null==n?void 0:null===(t=n.data.config)||void 0===t?void 0:t.subgraph;if(!o)return{};let a=h.parse(o),i=f(a);i.length&&e.log("Composite subgraph reference errors: ".concat(JSON.stringify(i)));let l=await m(a),d={};for(let e of Object.keys(l)){let t=l[e],n={};for(let e of Object.keys(t)){let o=t[e];n[e]=void 0===o?null:o}d[e]=n}return{result:d}},b.branch=async e=>{var t,n;let o=e.graph.nodes.find(t=>t.id===e.nodeId),a=null!==(n=null==o?void 0:null===(t=o.data.config)||void 0===t?void 0:t.key)&&void 0!==n?n:"input",i=function(e,t){let n=e[t];return Array.isArray(n)?{branches:n.map(e=>({item:e}))}:{branches:[{item:n}]}}(e.inputs,a),l={};for(let e of Object.keys(i)){let t=i[e],n={},o=null!=t?t:{};for(let e of Object.keys(o)){let t=o[e];n[e]=void 0===t?null:t}l[e]=n}return{branches:l}},b.merge=async e=>{var t,n,o,a;let i=e.graph.nodes.find(t=>t.id===e.nodeId),l=null!==(o=null==i?void 0:null===(t=i.data.config)||void 0===t?void 0:t.strategy)&&void 0!==o?o:"last";return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"last",n={};for(let o of e)for(let e of Object.keys(o))("first"!==t||void 0===n[e])&&(n[e]=o[e]);return n}((null!==(a=null==i?void 0:null===(n=i.data.config)||void 0===n?void 0:n.inputs)&&void 0!==a?a:Object.keys(e.inputs)).map(t=>({[t]:e.inputs[t]})),l)},b.condition=async e=>{var t,n,o,a,i,l;let d=e.graph.nodes.find(t=>t.id===e.nodeId),s=null!==(a=null==d?void 0:null===(t=d.data.config)||void 0===t?void 0:t.predicateKey)&&void 0!==a?a:"ok",r=null!==(i=null==d?void 0:null===(n=d.data.config)||void 0===n?void 0:n.truthyOut)&&void 0!==i?i:"true",c=null!==(l=null==d?void 0:null===(o=d.data.config)||void 0===o?void 0:o.falsyOut)&&void 0!==l?l:"false",u=function(e,t,n,o){let a=!!e[t],i={};return i[a?n:o]=e,i}(e.inputs,s,r,c),p=u[r],g=u[c],h=e=>{if(!e)return{};let t={};for(let n of Object.keys(e)){let o=e[n];t[n]=void 0===o?null:o}return t};return{[r]:h(p),[c]:h(g)}},b.csvInput=async e=>{var t,n;let o=e.graph.nodes.find(t=>t.id===e.nodeId);return{output:String(null!==(n=null==o?void 0:null===(t=o.data.config)||void 0===t?void 0:t.value)&&void 0!==n?n:"").trim().split(/\r?\n/).map(e=>e.split(","))}},b.map=async e=>{var t,n;let o=e.graph.nodes.find(t=>t.id===e.nodeId),a=null!==(n=null==o?void 0:null===(t=o.data.config)||void 0===t?void 0:t.mode)&&void 0!==n?n:"uppercase",i=e.inputs.input;if(Array.isArray(i))return{result:i.map(e=>(Array.isArray(e)?e:[e]).map(e=>{let t=String(null!=e?e:"");return"uppercase"===a?t.toUpperCase():t}))};let l=String(null!=i?i:"");return{result:"uppercase"===a?l.toUpperCase():l}},b.sinkConsole=async e=>(e.log("SINK: ".concat(JSON.stringify(e.inputs))),{})}},function(e){e.O(0,[627,780,747,971,117,744],function(){return e(e.s=3006)}),_N_E=e.O()}]);